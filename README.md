# folder galaxy（文件夹星座图）

一个用「星座图」可视化磁盘空间占用的 Windows 桌面应用，帮你快速看清盘里哪些目录 / 文件占了多少空间、哪些是清理候选。基于 Electron + Node.js + TypeScript + React + D3 构建。

---

## 如何使用

1. 打开应用  
   启动后会看到一块深色画布和右上角的控制面板。

2. 选择要分析的目录  
   点击右上角的「选择目录」，在系统对话框中选中你想分析的根目录（整块盘符、用户目录、视频盘等都可以）。

3. 配置扫描选项（可选）  
   - 「包含隐藏」：是否包括 `.git`、`Thumbs.db` 等隐藏内容。  
   - 「包含系统目录」：是否扫描 `Windows`、`Program Files`、`$Recycle.Bin` 等系统目录（系统盘一般不建议勾选，会很慢）。  
   - 「包含文件」：是否在图中为单个文件画出圆点，而不仅仅是文件夹。

4. 开始 / 取消扫描  
   - 点击「开始扫描」后，下方会实时显示「已扫描文件数 / 目录数 / 耗时」。  
   - 扫描中可以随时点击「取消」，避免长时间扫描大目录。

5. 读懂星座图  
   - 每个圆代表一个目录或文件：圆越大，占用空间越大。  
   - 颜色大致对应文件类型（视频、图片、文档、压缩包等），目录会根据其中占主导的类型自动着色。  
   - 鼠标移动到圆上会弹出 tooltip，显示名称、大小、占比、文件数、子目录数和完整路径。

6. 交互操作  
   - 左键点击目录圆：钻取到该目录，仅查看该目录下的内容；下方的路径 breadcrumbs 会随之更新。  
   - 右键点击任意圆：  
     - 「在文件管理器中打开」：在系统文件管理器中打开目录或文件所在目录。  
     - 「用系统默认方式打开」：交给操作系统默认程序打开该文件或目录。  
   - 右下角 info panel：展示当前选中节点的详细信息。  
   - 滚轮缩放 + 拖拽：支持滚轮缩放和鼠标拖动画布，方便在全局和局部之间切换。

7. 利用结果清理空间  
   找出特别大的目录或单个文件，右键「在文件管理器中打开」，再用你熟悉的方式删除或移动它们，即可完成清理。

---

## 功能介绍

### 目录扫描与过滤

- 支持选择任意本地目录作为根节点（盘符、用户目录、项目目录等）。  
- 默认递归扫描整个子树，可通过扫描选项控制是否：
  - 包含隐藏文件 / 目录；  
  - 包含系统目录；  
  - 展开到单个文件。  
- 为避免死循环或无限挂载：
  - 使用真实路径去重，防止符号链接 / 硬链接形成环；  
  - `followSymlinks` 默认关闭，只有明确启用时才跟随。

### 空间统计与类型分组

- 对每个目录统计：  
  - `totalSize`：目录下所有内容的总大小；  
  - `fileCount` / `subfolderCount`：文件和子目录数量。  
- 按文件类型分组统计体积和数量（视频、图片、音频、文档、代码、压缩包、其它），用于配色和信息展示。  
- 在「包含文件」模式下，会额外记录每个文件的大小和类型，以便在前端画出文件级别的节点。

### 星座图可视化（Circle Packing）

- 使用 D3 的 `pack` 布局生成层级圆形打包图，全局采用深色、偏暖色调主题。  
- 每一个目录 / 文件都是一个圆：
  - 半径与 `totalSize` 成比例；  
  - 目录节点根据主导类型着色，文件节点按自身类型着色；  
  - 通过细微描边和层级半径调整，保证视觉上层次清晰且没有明显「黑边」。  
- 交互体验：
  - hover：放大并高亮当前圆，同时展示 tooltip。  
  - click：钻取 / 聚焦到某个目录，仅查看其子树。  
  - 面包屑导航：一键返回任意父级目录视图。  
  - info panel：集中显示当前选中节点的关键指标。

### 性能与安全限制

- `MAX_FILE_THRESHOLD = 10_000`：  
  在「包含文件」模式下，如果单次扫描的文件数超过此阈值，会主动报错并终止渲染，防止图中节点过多导致 UI 卡顿。  
- 软文件上限 `softFileLimit`（默认 1,000,000）：  
  扫描时做软限制，为后续扩展「预警」或「统计」预留空间。  
- 扫描过程中会定期通过 IPC 推送进度（已扫描的文件数 / 目录数 / 耗时），并实时展示在界面上。

---

## 开发与构建

### 环境准备

- Node.js 18+（建议使用 LTS 版本）。  
- 当前主要支持 Windows 桌面环境。

### 安装依赖

```bash
npm install
```

### 开发模式启动

```bash
npm run dev
```

- Vite dev server 提供渲染进程页面（默认端口 5176）。  
- tsup 以 watch 模式构建主进程和 preload 到 `dist/main`。  
- Electron 在依赖就绪后自动启动。

### 生产构建与启动

```bash
npm run build
npm start
```

- `npm run build`：清理 `dist/`，构建主进程 + preload 到 `dist/main`，构建前端到 `dist/renderer`。  
- `npm start`：基于 `dist/main/main.js` 和 `dist/renderer/index.html` 启动 Electron 应用。

### 打包 Windows 安装包

```bash
npm run package
```

使用 `electron-builder` 生成 Windows 安装程序（NSIS），打包配置见 `package.json` 中的 `"build"` 字段。

---

## 技术栈与项目结构（简要）

- 技术栈：Electron、Node.js、TypeScript、React、D3、Vite、tsup、electron-builder。  
- 目录结构（简化）：

```text
├─ src
│  ├─ main        # Electron 主进程 + 扫描逻辑 + preload
│  ├─ renderer    # React + D3 前端界面
│  ├─ preload     # window.api 类型声明
│  └─ shared      # 扫描结果与 IPC 公共类型
├─ build          # 打包资源（图标等）
├─ dist           # 构建输出（main + renderer）
└─ package.json   # npm 脚本与依赖
```

---

## 许可证

MIT
